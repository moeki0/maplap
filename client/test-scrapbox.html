<!DOCTYPE html>
<html>
<head>
    <title>Scrapbox API Test</title>
</head>
<body>
    <h1>Scrapbox API Test</h1>
    <input type="text" id="projectName" placeholder="Project Name" value="test-project">
    <input type="text" id="query" placeholder="Search Query" value="test">
    <button onclick="testAPI()">Test API</button>
    <div id="result"></div>

    <script>
        async function searchScrapboxTitles(projectName, query) {
            console.log('[Scrapbox API] Starting search:', { projectName, query });
            
            if (!projectName || !query.trim()) {
                console.log('[Scrapbox API] Invalid params, returning empty array');
                return [];
            }

            try {
                const encodedQuery = encodeURIComponent(query);
                const url = `https://scrapbox.io/api/pages/${projectName}/search/titles?q=${encodedQuery}`;
                
                console.log('[Scrapbox API] Fetching URL:', url);
                
                const response = await fetch(url);
                
                console.log('[Scrapbox API] Response status:', response.status);
                
                if (!response.ok) {
                    console.warn(`[Scrapbox API] API error: ${response.status} ${response.statusText}`);
                    return [];
                }
                
                const data = await response.json();
                console.log('[Scrapbox API] Response data:', data);
                
                if (Array.isArray(data)) {
                    const results = data.map(title => ({
                        title,
                        url: `https://scrapbox.io/${projectName}/${encodeURIComponent(title)}`
                    }));
                    console.log('[Scrapbox API] Processed results:', results);
                    return results;
                }
                
                console.warn('[Scrapbox API] Response is not an array:', typeof data);
                return [];
            } catch (error) {
                console.error('[Scrapbox API] Fetch error:', error);
                return [];
            }
        }

        async function testAPI() {
            const projectName = document.getElementById('projectName').value;
            const query = document.getElementById('query').value;
            
            const results = await searchScrapboxTitles(projectName, query);
            
            document.getElementById('result').innerHTML = `
                <h2>Results (${results.length} items):</h2>
                <pre>${JSON.stringify(results, null, 2)}</pre>
            `;
        }
    </script>
</body>
</html>